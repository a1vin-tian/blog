---
title: SRE-方法论
date: 2019-06-06 16:47:08
tags: SRE
---

SRE是指Site Reliability Engineer (网站可靠性工程师)。他是软件工程师和系统管理员的结合，一个SRE工程师基本上需要掌握很多知识：算法，数据结构，编程能力，网络编程，分布式系统，可扩展架构，故障排除。

SRE成员的特点：
* 对重复性、手工性的操作有天然的排斥感
* 有足够的技术能力快速开发软件以代替手工操作

SRE通过设计、构建自动化的工具来取代人工操作。 通过操作代码来管理机器，而不是人直接去管理机器。


# 确保长期关注研发工作
限制运维工作在50%以内。 以保证大部分时间都在研发工作上. 
how？
1. 处理问题一天不要超过2个紧急事件。运维人员需要跟进每一个问题，把问题的原委搞清楚才能得到成长和改进。
2. 尽量将问题转给研发团队。
3. 轮班on-call，把时间分配开
4. 少做手动操作，把手动操作自动化以节省时间

# 在保证服务SLO的前提下最大化迭代速度。
最主要的矛盾是迭代创新的速度与产品稳定程度之间的矛盾。 
在SRE模型中，我们正面对这些矛盾，使用的工具是`错误预算`。


首先，任何产品都不可能保证100%的可靠信，所以我们需要根据实际情况，设置一个我们可以实现并且用户可以接受的可靠性的指标。
比如我们的用户的可以接受的可靠性是99%，那错误预算就是1%，我们可以使用错误预算最大化的保证新功能的上线速度，用于做一些创新和正常的业务需求.

可靠性的目标可以考虑以下几个方面:
* 服务的可靠性达到多少用户才会满意呢？
* 用户是否有其他的替代方案
* 是否会影响用户的使用模式

# 监控系统
监控系统可以衡量一个系统的可用性和质量的重要手段。 简单来说就是收集各层的性能或者是业务指标，然后加以聚合和汇总，呈现出动态的视图。可以针对这些指标设置阈值和规则，进行各种各样的报警。 如Email、短信等。
但是这样的报警策略并不是很有效的需要人去处理，人需要阅读错误信息，再去排查问题，这本身就是错误的。理想状态下，监控系统应该能自己分析报警信息，然后自动决策， 或者是给出合理的建议，让人去选择。


# 应急事件处理
MTTF(平均失败时间)和MTTR(平均恢复时间)，是评价一个团队将系统恢复到正常的最有效的指标。
出现故障后，如果能通过自动故障处理的程序把系统恢复那再好不过了。不过有好些情况还是需要人工干预的。 通过事先预案并且将最佳方法记录在”运维手册“中，这样可以有效的降低MTTR. 
学过武功秘籍的人去解决问题，自然会快一些和高效一些. 而且随着时间的推移，运维手册会不断的完善。也方便对新人做培训

# 变更管理
经验来讲，70%的生产事故来源于变更。变更管理的最佳事件使用自动化来完成以下项目：
* 渐进式发布机制。 - 减少受影响面积
* 迅速而准确的检测到问题的发生。 - 减少故障时间
* 出现问题时可以自动的快速回滚。  - 减少故障时间

# 需求预测和容量规划
保障业务有足够的容量和冗余度来服务预测中的外来的需求。

容量规划必须有几个必要的步骤:
* 必须有一个准确的自然增长需求预测模型，需求预测的时间应该超过资源获取的时间。
* 规划中必须有准确的非自然增长的需求来源的统计
* 必须有周期性压力测试，以便准确地将系统原始资源信息与业务容量对应起来。

# 资源部署
SRE要负责资源的部署。 添加新的资源可以是机器、或者是集群，当然添加过后还需要改动对应的配置，如负载均衡等等，这些都会对整体的稳定性有些影响，不过这个k8s下目前还是比较简单的。 

# 效率与性能
一个是高效的利用资源的，提升利用率。这样可以更加节省成本。SRE需要提高资源的利用率。 一个业务总资源使用情况由以下几个因素：

* 用户流量 
* 可用容量 
* 资源利用率

SRE可以通过需求模型的预测和监控数据来优化资源的使用率。

延迟在负载高的情况下会上升，当负载到达临界值的时候，系统会逐渐变慢，甚至全部停止。SRE可以通过设置预期的延迟目标和维护足够的容量解决这个问题。
